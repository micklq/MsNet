@using MSNet.Common.Passports;
@{
    int? menuIndex = ViewBag.MenuIndex;
    var Permissions = Permission.FindWithAll();   
    var user = MSNet.Common.Web.UserAuthentication.CurrentUser;
    var uPermIds = (from q in user.RolePermissions select q.PermissionId).ToList(); 

}
<!DOCTYPE html>
<html>
<head>
    <title>@ViewBag.Title</title>
    <link href="@Url.Content("~/Content/themes/base.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.8.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jfn.v2.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jsMain.js")" type="text/javascript"></script>
    <link type="text/css" rel="stylesheet" href="/Content/Site1.css" />
</head>
<body>
    <div class="top_table">
        <div class="top_table_leftbg">
            <div class="system_logo"><img src="@Url.Content("~/Content/images/logo_up.gif")"></div>
            <div class="menu">@(user.UserName)您好！&nbsp;&nbsp;<a href="/Admin/EditCurrUsers?uid=@(user.PassportId)">修改密码</a>&nbsp;&nbsp;<a href="@Url.Content("SignOut")">退出</a>&nbsp;&nbsp;&nbsp;</div>
        </div>
    </div>
    <div style="height:3px; background:#ebeff3;"></div>

    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="iCTab">
        <tr>
            <td id="frmTitle" align="left" valign="top" class="iCcW181">
                <table border="0" cellspacing="0" cellpadding="0" class="leftMenu">
                    <tr>
                        <td class="TopBorder">
                            <div id="MainNav">
                                <ul class="Nav">
                                   @foreach (var p in Permissions.Where(o => o.ParentId.Equals(0)).ToList())
                                   {
                                       if (uPermIds.Contains(p.PermissionId))
                                       {

                                        <li id="@p.PermissionId" class="open">
                                            @if (!p.Value.IsNullOrEmpty())
                                            {
                                                <div><a href="@(p.Value)">@p.Name</a></div>
                                            }
                                            else
                                            {
                                                <div>@p.Name</div>
                                            }
                                         @{
                                           foreach (var pp in Permissions.Where(o => o.ParentId.Equals(p.PermissionId)).ToList())
                                           {

                                               if (uPermIds.Contains(pp.PermissionId))
                                               {

                                                   var cUrl = "http://{0}{1}".FormatString(Request.Url.Host, pp.Value);
                                                  <p><a href="@(cUrl)"> @(pp.Name)</a></p>                                                  
                                               }
                                           }
                                         }
                                        </li>

                                     }


                                }
                                </ul>
                            </div>
                            <div style=" height:100px; width:100%;  display:block;"></div>
                        </td>
                    </tr>
                </table>

            </td>
            <td class="iCsysBar" valign="middle">
                <div><span id="switchPoint"></span></div>
            </td>
            <td align="left" valign="top">
                @RenderBody()
            </td>
        </tr>
    </table>
    <div class="top_table">
        
  </div>
   <script type="text/javascript">
       $(function () {

           var winHeight = $(window).height()-85;           
           $("#frmTitle").css("height",winHeight +"px");
       })

   </script>
</body>
</html>