@{
    ViewBag.Title = "用户登录";
    Layout = null;
    var returnUrl = (Request["returnUrl"] ?? "");
}

<!DOCTYPE html>
<html>
<head>
    <title>后台登陆</title>
    <link href="@Url.Content("~/Content/themes/login.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.8.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jfn.v2.js")" type="text/javascript"></script>
</head>
<body>
    <div id="Main">
        <div id="LoginBar">
            <ul>
                <li class="LoginTop"></li>
                <li class="FormNav">
                    <form id="formLogin" method="post" action="@Url.Action("SignIn")">
                        <input type="hidden" id="returnUrl" name="returnUrl" value="@(returnUrl)" />
                        <dl>
                            <dd>&nbsp;</dd>
                            <dd><label>用户登录</label></dd>
                            <dd>
                                <label>用户名:</label><input type="text" id="uName" name="uName" class="Login_text" value="" maxlength="16"
                                                          data-val="true"
                                                          data-val-length="用户名需要5-16个字符！"
                                                          data-val-required="用户名不能为空！"
                                                          data-val-length-max="16"
                                                          data-val-length-min="5" />
                            </dd>
                            <dd>
                                <label>密　码:</label><input type="password" id="uPass" name="uPass" class="Login_text" value="" maxlength="16"
                                                          data-val="true"
                                                          data-val-length="密码需要6-16个字符！"
                                                          data-val-length-max="16"
                                                          data-val-length-min="6"
                                                          data-val-required="密码不能为空！" />
                            </dd>
                            <dd>
                                <label>验证码:</label><input type="text" id="Vcode" name="Vcode" class="Login_text_1_2" maxlength="4"
                                                          data-val="true"
                                                          data-val-length="验证码为4个字符."
                                                          data-val-length-max="4"
                                                          data-val-length-min="4"
                                                          data-val-required="验证码不能为空！" />
                                <img src="@Url.Action("VCode")" style="cursor:pointer; display:inline;" title="点击刷新验证码" alt="点击刷新验证码" id="VcodeImg" class="Login_VcodeImg" onclick="this.src='@Url.Action("VCode")?t='+Math.random()" />
                            </dd>
                            <dd class="Doing" id="ddDoing" style="display:none;"><img src="@Url.Content("~/Content/Images/ajax_loading.gif")" style="display:inline;" /> 正在登录...</dd>
                            <dd id="ddButton"><input type="submit" value="" class="Login_button" /></dd>
                            <dd class="msgError">
                                <span class="field-validation-valid" data-valmsg-for="uName" data-valmsg-replace="true"></span>
                                <span class="field-validation-valid" data-valmsg-for="uPass" data-valmsg-replace="true"></span>
                                <span class="field-validation-valid" data-valmsg-for="Vcode" data-valmsg-replace="true"></span>
                                <span id="MessageBox"></span>
                            </dd>
                            <dd>&nbsp;<div class="clear"></div></dd>
                        </dl>
                    </form>
                </li>
                <li class="LoginTop2"></li>
            </ul>
        </div>
    </div>
    <script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.extend.js")" type="text/javascript"></script>
    <script type="text/javascript">
    //$(function () {
        $("#uName,#uPass,#Vcode").keyup(function () { $("#MessageBox").html(""); });
        $("#formLogin").submit(function () {
            var options = {
                beforeSubmit: function (formData, jqForm, options) {
                    $("#MessageBox").html("");
                    var v = jqForm.validate();
                    if (!v.form())
                        return false;
                    $("#ddButton").hide();
                    $("#ddDoing").show();
                    return true;
                },
                success: function (responseText, statusText) {
                    if (statusText == "success") {
                        var d = null;
                        try {
                            d = typeof responseText == 'string' ? responseText.toJsonObj() : responseText; // eval('(' + responseText + ')');

                        } catch (ex) {
                            d = { success: false, message: '服务器出现错误' };
                        }
                        if (d.success) {   
                            location.href = unescape(d.message);
                        }
                        else {
                            $("#VcodeImg").click();
                            $("#ddButton").show();
                            $("#ddDoing").hide();
                            $("#MessageBox").html("").html(d.message);

                        }
                    }
                    else {
                        $("#VcodeImg").click();
                        $("#ddButton").show();
                        $("#ddDoing").hide();
                        $("#MessageBox").html("").html("提交失败");
                    }
                }
            };
            $(this).ajaxSubmit(options);
            return false;
        });
   // });
    </script>
</body>
</html>