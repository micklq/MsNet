<?xml version="1.0" encoding="utf-8" ?>
<root xmlns="http://m2sa.net/Schema/SqlMapping">
  <module moduleName="UserPassportRepository" dbName="MSNet.SQLServer">
    <sqlWrap sqlName="Insert" supportDBType="SqlServer, MySql">
      insert into UserPassport (UserName,Email,MobilePhone, PassportStatus,CreatedTime, LastModifiedTime)
      values (@UserName,@Email,@MobilePhone,@PassportStatus,@CreatedTime, @LastModifiedTime);
      select @@identity
    </sqlWrap>
    <sqlWrap sqlName="Update" supportDBType="SqlServer, MySql">
      update UserPassport set UserName = @UserName, Email=@Email,LastModifiedTime=@LastModifiedTime where PassportId = @Id
    </sqlWrap>
    <sqlWrap sqlName="DeleteById" supportDBType="SqlServer, MySql">
      update UserPassport set PassportStatus=999 where PassportId = @Id
    </sqlWrap>
    <sqlWrap sqlName="SelectById" supportDBType="SqlServer, MySql">
      select * from UserPassport where PassportId = @Id
    </sqlWrap> 
    <sqlWrap sqlName="SignIn" supportDBType="SqlServer, MySql">
      update UserProfile set LastSignInTime=@LastSignInTime where PassportId = @Id;
      update UserSecurity set IsLocked = @IsLocked, LastLockedTime=@LastLockedTime, FailedPasswordAttemptCount=@FailedPasswordAttemptCount
      where PassportId = @Id and IsLocked = 1
    </sqlWrap>
    <sqlWrap sqlName="SelectByMobile" supportDBType="SqlServer, MySql">
      select  * from UserPassport where (MobilePhone = @MobilePhone or UserName = @MobilePhone) order by PassportId desc;
    </sqlWrap>   
    <sqlWrap sqlName="SelectPassportIdByEmail" supportDBType="SqlServer, MySql">
      select PassportId from UserPassport where Email = @Email;
    </sqlWrap>
    <sqlWrap sqlName="SelectPassportIdByUserName" supportDBType="SqlServer, MySql">
      select PassportId from UserPassport where UserName = @UserName;
    </sqlWrap>
    <sqlWrap sqlName="SelectUserSecurityById" supportDBType="SqlServer, MySql">
      select * from UserPassport where PassportId = @Id;
      select * from UserSecurity where PassportId = @Id;
    </sqlWrap>
  </module>
</root>
